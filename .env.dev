# ===========================================
# OpticsERP Development Environment Configuration
# ===========================================
# Purpose: Development environment with mock services
# Usage: Copy to .env before running docker-compose.dev.yml
#
# IMPORTANT: This file contains DEVELOPMENT settings only!
#            DO NOT use these values in production!
#
# Last Updated: 2025-11-30
# ===========================================

# ===========================================
# PostgreSQL Configuration
# ===========================================
POSTGRES_DB=opticserp_dev
POSTGRES_USER=odoo
POSTGRES_PASSWORD=odoo_dev_password_123

# PostgreSQL connection string (for external tools)
DATABASE_URL=postgresql://odoo:odoo_dev_password_123@localhost:5433/opticserp_dev

# ===========================================
# Odoo Configuration
# ===========================================
ODOO_ADMIN_PASSWORD=admin
ODOO_DB_NAME=opticserp_dev
ODOO_DB_FILTER=^opticserp_dev$

# Development mode (auto-reload on file changes)
ODOO_WORKERS=0
ODOO_DEV_MODE=all
ODOO_LOG_LEVEL=debug

# Session timeout (24 hours for development)
ODOO_SESSION_TIMEOUT=86400

# ===========================================
# KKT Adapter Configuration (Mock Mode)
# ===========================================

# Mock mode enabled (no real fiscal hardware)
KKT_MODE=mock
OFD_MODE=http

# Mock service URLs
MOCK_OFD_URL=http://mock_ofd:9000
MOCK_ODOO_URL=http://mock_odoo_api:8070

# KKT Adapter API
KKT_ADAPTER_URL=http://kkt_adapter:8000
KKT_ADAPTER_TIMEOUT=10

# Development-specific settings (faster sync for quick feedback)
BUFFER_MAX_SIZE=100
SYNC_INTERVAL=5
CIRCUIT_BREAKER_THRESHOLD=3
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=30

# Heartbeat configuration
HEARTBEAT_INTERVAL=30
HEARTBEAT_URL=http://mock_odoo_api:8070/api/v1/kkt/heartbeat

# ===========================================
# Redis Configuration
# ===========================================
REDIS_URL=redis://localhost:6380/0
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# ===========================================
# Mock OFD Server Configuration
# ===========================================
OFD_PORT=9000
OFD_HOST=0.0.0.0

# Mock OFD behavior (for testing failure scenarios)
MOCK_OFD_FAILURE_MODE=disabled
MOCK_OFD_FAILURE_COUNT=0
MOCK_OFD_RESPONSE_DELAY=0

# ===========================================
# Mock Odoo API Server Configuration
# ===========================================
ODOO_PORT=8070
ODOO_HOST=0.0.0.0

# ===========================================
# Logging Configuration
# ===========================================
LOG_LEVEL=DEBUG
PYTHONUNBUFFERED=1
FLASK_ENV=development

# ===========================================
# Monitoring Configuration (Optional)
# ===========================================
# Uncomment to enable Prometheus + Grafana
# COMPOSE_PROFILES=monitoring

# Prometheus
PROMETHEUS_PORT=9091
PROMETHEUS_RETENTION_TIME=7d

# Grafana
GRAFANA_PORT=3001
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# ===========================================
# Development Helpers
# ===========================================

# API Base URLs (for external testing tools like Postman)
API_BASE_URL=http://localhost:8000
ODOO_BASE_URL=http://localhost:8069

# Network name (for connecting external containers)
DOCKER_NETWORK=opticserp_dev_network

# ===========================================
# Testing Configuration
# ===========================================

# pytest configuration
PYTEST_ADDOPTS=-v --tb=short --color=yes

# Test database (separate from development)
TEST_DATABASE_URL=postgresql://odoo:odoo_dev_password_123@localhost:5433/opticserp_test

# ===========================================
# Feature Flags (Development)
# ===========================================

# Enable experimental features
FEATURE_OFFLINE_MODE=true
FEATURE_CIRCUIT_BREAKER=true
FEATURE_HLC_TIMESTAMPS=true
FEATURE_DISTRIBUTED_LOCK=true

# Debug flags
DEBUG_BUFFER_OPERATIONS=true
DEBUG_CIRCUIT_BREAKER=true
DEBUG_SYNC_WORKER=true

# ===========================================
# Security (Development Only)
# ===========================================

# JWT secret (for API authentication)
JWT_SECRET=dev_secret_key_do_not_use_in_production

# API Keys (for testing)
API_KEY_DEV=dev_api_key_12345

# ===========================================
# External Services (Optional)
# ===========================================

# If testing with real OFD (not recommended for development)
# REAL_OFD_API_URL=https://ofd-provider.ru/api/v1
# REAL_OFD_API_TOKEN=your_ofd_token_here

# If testing with real Odoo instance
# REAL_ODOO_URL=http://localhost:8069
# REAL_ODOO_DB=opticserp_dev
# REAL_ODOO_USERNAME=admin
# REAL_ODOO_PASSWORD=admin

# ===========================================
# Performance Tuning (Development)
# ===========================================

# PostgreSQL connection pool
PG_MAX_CONNECTIONS=20
PG_MIN_CONNECTIONS=2

# Redis connection pool
REDIS_MAX_CONNECTIONS=10

# HTTP client timeouts
HTTP_CONNECT_TIMEOUT=5
HTTP_READ_TIMEOUT=10
HTTP_TOTAL_TIMEOUT=15

# ===========================================
# Volume Paths (for manual inspection)
# ===========================================

# SQLite buffer database
BUFFER_DB_PATH=./kkt_adapter/data/buffer.db

# Odoo filestore
ODOO_DATA_DIR=/var/lib/odoo

# PostgreSQL data
POSTGRES_DATA_DIR=/var/lib/postgresql/data

# ===========================================
# Quick Start Commands
# ===========================================
#
# 1. Start all services:
#    docker-compose -f docker-compose.dev.yml up -d
#
# 2. Start with monitoring:
#    COMPOSE_PROFILES=monitoring docker-compose -f docker-compose.dev.yml up -d
#
# 3. View logs:
#    docker-compose -f docker-compose.dev.yml logs -f
#
# 4. Stop all services:
#    docker-compose -f docker-compose.dev.yml down
#
# 5. Stop and remove volumes:
#    docker-compose -f docker-compose.dev.yml down -v
#
# 6. Rebuild services:
#    docker-compose -f docker-compose.dev.yml build --no-cache
#
# ===========================================
# Service Health Checks
# ===========================================
#
# After startup, verify services are healthy:
#
# All services status:
#   docker-compose -f docker-compose.dev.yml ps
#
# Individual service health:
#   curl http://localhost:8069/web/health        # Odoo
#   curl http://localhost:8000/v1/health         # KKT Adapter
#   curl http://localhost:9000/ofd/v1/health     # Mock OFD
#   curl http://localhost:8070/api/v1/health     # Mock Odoo API
#
# ===========================================
