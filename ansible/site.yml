---
# Main playbook for OpticsERP server preparation
# Usage: ansible-playbook -i inventories/production/hosts.yml site.yml

- name: Prepare all servers - Common setup
  hosts: all
  become: true
  roles:
    - common
    - security

- name: Setup Odoo servers
  hosts: odoo_servers
  become: true
  roles:
    - docker
    - nginx
    - role: postgresql
      when: "'db_servers' not in group_names"
    - role: redis
      when: "'db_servers' not in group_names"

- name: Setup KKT Adapter servers
  hosts: kkt_adapters
  become: true
  roles:
    - docker
    - nginx

- name: Setup Database servers
  hosts: db_servers
  become: true
  roles:
    - postgresql
    - redis

- name: Setup Monitoring servers
  hosts: monitoring_servers
  become: true
  roles:
    - docker
    - monitoring
    - nginx

- name: Deploy Odoo application
  hosts: odoo_servers
  become: true
  roles:
    - odoo
