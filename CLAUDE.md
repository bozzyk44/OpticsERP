# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Claude

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã (¬ß1-4)
1. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏](#1-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∑–∞–¥–∞—á–∞–º–∏)
2. [–Ø–∑—ã–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#2-—è–∑—ã–∫–∏-–∏-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
3. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–º–∏](#3-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–ø–æ—Ä—Ç–∞–º–∏-–∫—Ä–∏—Ç–∏—á–Ω–æ)
4. [Git Workflow](#4-git-workflow-–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (¬ß5-8)
5. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#5-–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
6. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#6-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
7. [–ê–¥–∞–ø—Ç–µ—Ä –ö–ö–¢](#7-–∞–¥–∞–ø—Ç–µ—Ä-–∫–∫—Ç-–¥–µ—Ç–∞–ª—å–Ω–∞—è-–∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è)
8. [–ü–ª–∞–Ω —Å–ø—Ä–∏–Ω—Ç–æ–≤](#8-–ø–ª–∞–Ω-—Å–ø—Ä–∏–Ω—Ç–æ–≤)

### –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã (¬ß9-13)
9. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã](#9-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–º–µ—Ç—Ä–∏–∫–∏)
10. [–ß–µ–∫-–ª–∏—Å—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è](#10-—á–µ–∫-–ª–∏—Å—Ç-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)
11. [–†–µ–≥–ª–∞–º–µ–Ω—Ç—ã —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏](#11-—Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã-—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏)
12. [–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏](#12-—Å–ª–µ–¥—É—é—â–∏–µ-—à–∞–≥–∏)
13. [AI Agent Handoff](#13-ai-agent-handoff-protocol)

---

## 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏

- **–ö–†–ò–¢–ò–ß–ù–û:** –†–µ—à–∞—Ç—å —Ç–æ–ª—å–∫–æ –û–î–ù–£ –∑–∞–¥–∞—á—É –∑–∞ –∑–∞–ø—Ä–æ—Å
- –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —à–∞–≥–æ–≤ ‚Üí —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ‚Üí –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π

### JIRA Integration (–ö–†–ò–¢–ò–ß–ù–û)

**API Credentials:**
- **–§–∞–π–ª:** `.env` (root –ø—Ä–æ–µ–∫—Ç–∞)
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
  - `JIRA_URL`: https://bozzyk44.atlassian.net
  - `JIRA_EMAIL`: bozzyk44@gmail.com
  - `JIRA_API_TOKEN`: API —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - `JIRA_PROJECT_KEY`: OpticsERP

**–í–∞–∂–Ω–æ:** `.env` –≤ `.gitignore` - –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:**
1. **–ü–ï–†–í–ò–ß–ù–û:** –†–µ–∞–ª—å–Ω–∞—è JIRA (WebFetch –æ—Ç bozzyk44.atlassian.net)
2. **–í–¢–û–†–ò–ß–ù–û:** `docs/jira/jira_import.csv` (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ JIRA –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)

**Workflow —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏:**

```bash
# 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ß–∏—Ç–∞—Ç—å jira_import.csv –Ω–∞–ø—Ä—è–º—É—é
grep "OPTERP-31" docs/jira/jira_import.csv

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∑–∞–¥–∞—á—É –∏–∑ JIRA
WebFetch(url: "https://bozzyk44.atlassian.net/browse/OPTERP-31")
```

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û):**

1. **–°–æ–∑–¥–∞—Ç—å task plan:** `docs/task_plans/YYYYMMDD_OPTERP-XX_description.md`
2. **Commit + Push** (—Å–º. ¬ß4 Git Workflow)
3. **–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ JIRA:**

```markdown
‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- [x] –ü—É–Ω–∫—Ç 1 –∏–∑ acceptance criteria
- [x] –ü—É–Ω–∫—Ç 2 –∏–∑ acceptance criteria
- [x] –ü—É–Ω–∫—Ç 3 –∏–∑ acceptance criteria

**–§–∞–π–ª—ã:**
- Created: file1.py, file2.py
- Modified: file3.py

**Commit:** [1dfd534](https://github.com/bozzyk44/OpticsERP/commit/1dfd534)
**Task Plan:** docs/task_plans/YYYYMMDD_OPTERP-XX_description.md

**–¢–µ—Å—Ç—ã:** ‚úÖ All tests passed
**Coverage:** 95%+

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)
```

**–í–∞–∂–Ω–æ:**
- –í–°–ï–ì–î–ê –æ–±—Ä–∞—â–∞–π—Å—è –∫ —Ä–µ–∞–ª—å–Ω–æ–π JIRA –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∑–∞–¥–∞—á–µ–π
- `jira_import.csv` - —Ç–æ–ª—å–∫–æ fallback –∏–ª–∏ –¥–ª—è bulk –æ–ø–µ—Ä–∞—Ü–∏–π
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ JIRA = proof of completion (–¥–ª—è –∞—É–¥–∏—Ç–∞)
- –°—Å—ã–ª–∫–∞ –Ω–∞ commit –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞

## 2. –Ø–∑—ã–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–Ø–∑—ã–∫–∏:**
- **English:** –ö–æ–¥, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–†—É—Å—Å–∫–∏–π:** –û—Å—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–•—Ä–∞–Ω–µ–Ω–∏–µ:**
- **–ö–†–ò–¢–ò–ß–ù–û:** –í–°–Ø –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¢–û–õ–¨–ö–û –≤ `/docs/`
- –î–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
- –ó–∞–ø—Ä–µ—â–µ–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å docs –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞

## 2.1. Ansible –∏ WSL (–ö–†–ò–¢–ò–ß–ù–û –¥–ª—è Windows)

**–ö–†–ò–¢–ò–ß–ù–û:** Ansible –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞—Ç–∏–≤–Ω–æ –Ω–∞ Windows! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WSL.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è Windows —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

**WSL (Windows Subsystem for Linux):**
- **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Ansible –Ω–∞ Windows
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞: `wsl --install -d Ubuntu-20.04`
- –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Windows

**–î–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–µ–∫—Ç—É –∏–∑ WSL:**
```bash
# –í WSL —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd /mnt/d/OpticsERP/ansible
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ansible –≤ WSL:**
```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python –∏ pip
sudo apt install -y python3 python3-pip python3-venv

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ansible
pip3 install ansible-core==2.16.3 ansible==9.2.0

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É
ansible --version
```

**Workflow —Å WSL:**
```bash
# 1. –û—Ç–∫—Ä—ã—Ç—å WSL —Ç–µ—Ä–º–∏–Ω–∞–ª (–Ω–µ Git Bash!)
wsl

# 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /mnt/d/OpticsERP/ansible

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å deployment
bash scripts/deploy-wrapper.sh
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã WSL:**
- **Docker:** –ó–∞–ø—É—Å–∫ Ansible –∏–∑ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- **Linux VM:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
- **–£–¥–∞–ª—ë–Ω–Ω—ã–π Linux:** SSH –Ω–∞ Linux –º–∞—à–∏–Ω—É

**–í–∞–∂–Ω–æ:**
- ‚ùå Git Bash –Ω–∞ Windows –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Ansible
- ‚ùå PowerShell –Ω–∞ Windows –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Ansible
- ‚úÖ WSL - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±
- ‚úÖ –í—Å–µ Ansible –∫–æ–º–∞–Ω–¥—ã –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ WSL

## 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞–º–∏ (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–∞–≤–∏–ª–æ:** –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã. –ù–ò–ö–û–ì–î–ê –Ω–µ –º–µ–Ω—è—Ç—å.

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|------|------------|
| **KKT Adapter** | **8000** | FastAPI REST API |
| Odoo | 8069 | Web server |
| PostgreSQL | 5432 | Database |
| Redis | 6379 | Celery broker |
| Prometheus | 9090 | Metrics |
| Grafana | 3000 | Dashboards |

### Workflow –ø—Ä–∏ –∑–∞–Ω—è—Ç–æ–º –ø–æ—Ä—Ç–µ

```bash
# 1. Kill process on port
python scripts/kill_port.py 8000

# 2. Start service on standard port
cd kkt_adapter/app && python main.py

# Kill all project ports
python scripts/kill_port.py 8000 --all
```

## 4. Git Workflow (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

**–ö–†–ò–¢–ò–ß–ù–û:** Commit + Push –ø–æ—Å–ª–µ –ö–ê–ñ–î–û–ô –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏ (OPTERP-X)!

### Workflow
```bash
# 1. Create branch
git checkout -b feature/task-name

# 2. Create task plan
docs/task_plans/YYYYMMDD_task_name.md

# 3. Work ‚Üí Test ‚Üí Commit
git add .
git commit -m "<type>(<scope>): description [OPTERP-X]"

# 4. Push (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
git push -u origin feature/task-name
```

### Commit Types
- `feat(scope):` ‚Äî –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- `test(scope):` ‚Äî —Ç–µ—Å—Ç—ã
- `fix(scope):` ‚Äî –±–∞–≥
- `docs(scope):` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `refactor(scope):` ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- `chore(scope):` ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏

### Pre-Commit Checklist
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (0 FAILED)
- [ ] Coverage ‚â•95% (unit tests)
- [ ] –õ–æ–≥–∏ —Ç–µ—Å—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã (`tests/logs/`)
- [ ] Task plan —Å–æ–∑–¥–∞–Ω (`docs/task_plans/`)
- [ ] JIRA ID –≤ commit message

### –ö–æ–≥–¥–∞ –¥–µ–ª–∞—Ç—å Commit + Push
- ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞–¥–∞—á–∞ OPTERP-X**
- ‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã**
- ‚úÖ **–ü–µ—Ä–µ–¥ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π**
- ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–∞ —Å–µ—Å—Å–∏—è —Ä–∞–±–æ—Ç—ã**
- ‚ùå –ù–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–¥ push!

### Test Logging (–ö–†–ò–¢–ò–ß–ù–û)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
tests/logs/{test_type}/YYYYMMDD_{TASK_ID}_{desc}.log
```

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
pytest tests/unit/test_hlc.py -v --tb=short 2>&1 | \
  tee tests/logs/unit/$(date +%Y%m%d)_OPTERP-3_hlc_tests.log
```

**–ü—Ä–∏ failed test:**
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `_FAILED.log`
2. –ó–∞–ø–∏—Å–∞—Ç—å –≤ `claude_history/`
3. –ù–ï –¥–µ–ª–∞—Ç—å commit –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### Session History
- –ö–æ–º–ø–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ –≤ `/claude_history`
- –§–æ—Ä–º–∞—Ç: `claude_history/session_YYYYMMDD.md`

---

# –ü–ª–∞–Ω –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ OpticsERP (Offline-First POS)

> **–í–µ—Ä—Å–∏—è:** 1.0 ‚Ä¢ –î–∞—Ç–∞: 2025-10-08 ‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: 1 —á–µ–ª–æ–≤–µ–∫
> **–ë–∞–∑–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:** docs/1-5 (–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞, –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è, –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞, –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º)

---

## ü§ñ AI Quick Start

### First Time Setup
```bash
make bootstrap  # Create structure, install deps, init DB
make verify-env # Verify Python 3.11+, Docker, SQLite, Git
make smoke-test # Run smoke test
```

### Essential Resources
1. **GLOSSARY.md** ‚Äî –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è (–ö–ö–¢, –û–§–î, –§–ù, Circuit Breaker)
2. **docs/5. –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º.md** ‚Äî Offline architecture (¬ß5.2-5.6)
3. **bootstrap/kkt_adapter_skeleton/schema.sql** ‚Äî SQLite schema

### First Task: SQLite Buffer CRUD
1. Read `bootstrap/kkt_adapter_skeleton/schema.sql`
2. Implement `kkt_adapter/app/buffer.py`:
   - `insert_receipt()`, `get_pending_receipts()`, `mark_synced()`, `move_to_dlq()`
3. Write tests in `tests/unit/test_buffer_db.py`
4. **Checkpoint:** `pytest tests/unit/test_buffer_db.py` ‚Üí all PASS

---

## 5. –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**–¶–µ–ª—å:** ERP/POS –¥–ª—è —Å–µ—Ç–∏ –æ–ø—Ç–∏–∫ (Odoo 17) —Å **offline-first —Ä–µ–∂–∏–º–æ–º**
- –ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å: 8+ —á–∞—Å–æ–≤ –±–µ–∑ –û–§–î
- –ë–∏–∑–Ω–µ—Å-–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å: ‚â•99.5%
- 54-–§–ó compliance
- 20 —Ç–æ—á–µ–∫ (40 –∫–∞—Å—Å)

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
1. **Offline-first** ‚Äî –∫–∞—Å—Å–∞ –∞–≤—Ç–æ–Ω–æ–º–Ω–∞, –æ–±–ª–∞–∫–æ –≤—Ç–æ—Ä–∏—á–Ω–æ
2. **–î–≤—É—Ö—Ñ–∞–∑–Ω–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî –ø–µ—á–∞—Ç—å ‚Üí –û–§–î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
3. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞** ‚Äî 100% —á–µ–∫–æ–≤ –≤ –û–§–î
4. **Hybrid Logical Clock** ‚Äî –º–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç NTP
5. **–ü–∞—Ç—Ç–µ—Ä–Ω—ã:** Circuit Breaker, Saga, Bulkhead, Event Sourcing

**Tech Stack:**
- **Backend:** Odoo 17, PostgreSQL 15, Redis, Celery
- **Edge:** FastAPI, SQLite (WAL), APScheduler
- **Monitoring:** Prometheus, Grafana, Jaeger
- **Infra:** Docker Compose, Nginx, NTP

---

## 5.1. –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

| –≠—Ç–∞–ø | –°—Ä–æ–∫–∏ | Exit Criteria |
|------|-------|---------------|
| **POC** | 06.10-09.11 (5w) | POC-4/5 ‚úÖ, –º–µ—Ç—Ä–∏–∫–∏ |
| **MVP** | 10.11-07.12 (4w) | UAT ‚â•95%, 0 –±–ª–æ–∫–µ—Ä–æ–≤ |
| **Buffer** | 08.12-14.12 (1w) | –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| **–ü–∏–ª–æ—Ç** | 15.12-11.01 (4w) | 99.5% uptime, 2 —Ç–æ—á–∫–∏ |
| **Soft Launch** | 12.01-25.01 (2w) | 5 —Ç–æ—á–µ–∫, capacity OK |
| **–ü—Ä–æ–¥** | 26.01-22.02 (4w) | 20 —Ç–æ—á–µ–∫, RTO‚â§1—á |

**–ò—Ç–æ–≥–æ:** 19 –Ω–µ–¥–µ–ª—å

---

## 6. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
OpticsERP/
‚îú‚îÄ‚îÄ addons/                      # Odoo –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ optics_core/             # –†–µ—Ü–µ–ø—Ç—ã, –ª–∏–Ω–∑—ã, –∑–∞–∫–∞–∑—ã –Ω–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ optics_pos_ru54fz/       # POS + 54-–§–ó + –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º
‚îÇ   ‚îú‚îÄ‚îÄ connector_b/             # –ò–º–ø–æ—Ä—Ç Excel/CSV
‚îÇ   ‚îî‚îÄ‚îÄ ru_accounting_extras/    # –ö–∞—Å—Å–æ–≤—ã–µ —Å—á–µ—Ç–∞, –æ—Ç—á—ë—Ç GP
‚îÇ
‚îú‚îÄ‚îÄ kkt_adapter/                 # –ê–¥–∞–ø—Ç–µ—Ä –ö–ö–¢ (–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å)
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py              # FastAPI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buffer.py            # SQLite –±—É—Ñ–µ—Ä + CRUD
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kkt_driver.py        # –î—Ä–∞–π–≤–µ—Ä –ö–ö–¢
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ofd_client.py        # –û–§–î API + Circuit Breaker
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sync_worker.py       # –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ heartbeat.py         # Heartbeat –∫ Odoo (30s)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hlc.py               # Hybrid Logical Clock
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buffer.db            # SQLite –æ—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cache.json           # –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à –∫–∞—Ç–∞–ª–æ–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.toml              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ poc/                     # POC-—Ç–µ—Å—Ç—ã (1-5)
‚îÇ   ‚îú‚îÄ‚îÄ uat/                     # UAT-—Ç–µ—Å—Ç—ã (01-11)
‚îÇ   ‚îú‚îÄ‚îÄ load/                    # –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Å—Ü–µ–Ω–∞—Ä–∏–∏ 1-4)
‚îÇ   ‚îî‚îÄ‚îÄ integration/             # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ docs/                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (5 —Ñ–∞–π–ª–æ–≤)
‚îú‚îÄ‚îÄ docker-compose.yml           # –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫
‚îú‚îÄ‚îÄ config.toml                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ CLAUDE.md                    # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

### 3.2 –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–¥—É–ª–∏ Odoo

#### optics_core
**–¶–µ–ª—å:** –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–∫–∏

**–ú–æ–¥–µ–ª–∏:**
- `optics.prescription` ‚Äî —Ä–µ—Ü–µ–ø—Ç (Sph, Cyl, Axis, PD, Add, Prism)
- `optics.lens` ‚Äî –ª–∏–Ω–∑–∞ (—Ç–∏–ø, –∏–Ω–¥–µ–∫—Å, –ø–æ–∫—Ä—ã—Ç–∏–µ)
- `optics.manufacturing.order` ‚Äî –∑–∞–∫–∞–∑ –Ω–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ

**Workflow –∑–∞–∫–∞–∑–∞:**
```
Draft ‚Üí Confirmed ‚Üí In Production ‚Üí Ready ‚Üí Delivered
```

**–§–∞–π–ª—ã:**
- `models/prescription.py`
- `models/lens.py`
- `models/manufacturing_order.py`
- `views/prescription_views.xml`
- `reports/order_label.xml` (—à—Ç—Ä–∏—Ö–∫–æ–¥)

#### optics_pos_ru54fz
**–¶–µ–ª—å:** POS + 54-–§–ó + –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–¥–∞–ø—Ç–µ—Ä–æ–º –ö–ö–¢ (API –≤—ã–∑–æ–≤—ã)
- X/Z-–æ—Ç—á—ë—Ç—ã (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–≥–∏ –§–§–î 1.2)
- –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π —á–µ–∫ (email/SMS)
- UI –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞ (–∏–Ω–¥–∏–∫–∞—Ü–∏—è –±—É—Ñ–µ—Ä–∞, –∞–ª–µ—Ä—Ç—ã)

**–ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏:**
- `pos.offline.buffer.status` ‚Äî —Å—Ç–∞—Ç—É—Å –±—É—Ñ–µ—Ä–∞ –¥–ª—è UI
- `pos.session.report` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è X/Z-–æ—Ç—á—ë—Ç–æ–≤

**–§–∞–π–ª—ã:**
- `models/pos_session.py` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
- `static/src/js/offline_indicator.js` (UI –≤–∏–¥–∂–µ—Ç)
- `controllers/kkt_adapter_api.py` (–æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ –∞–¥–∞–ø—Ç–µ—Ä–∞)

#### connector_b
**–¶–µ–ª—å:** –ò–º–ø–æ—Ä—Ç –ø—Ä–∞–π—Å–æ–≤/–æ—Å—Ç–∞—Ç–∫–æ–≤ Excel/CSV

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–æ—Ñ–∏–ª–∏ –º–∞–ø–ø–∏–Ω–≥–∞ (3+ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- –ü—Ä–µ–≤—å—é –∏–º–ø–æ—Ä—Ç–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- Upsert (—Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—Ç—á—ë—Ç –æ–± –æ—à–∏–±–∫–∞—Ö
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–∏ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±—É—Ñ–µ—Ä–∞—Ö

**–ú–æ–¥–µ–ª–∏:**
- `connector.import.profile` ‚Äî –ø—Ä–æ—Ñ–∏–ª—å –º–∞–ø–ø–∏–Ω–≥–∞
- `connector.import.job` ‚Äî –∑–∞–¥–∞—á–∞ –∏–º–ø–æ—Ä—Ç–∞
- `connector.import.log` ‚Äî –ª–æ–≥–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)

**–§–∞–π–ª—ã:**
- `models/import_profile.py`
- `models/import_job.py`
- `wizards/import_wizard.py` (–ø—Ä–µ–≤—å—é)
- `controllers/import_api.py`

#### ru_accounting_extras
**–¶–µ–ª—å:** –ö–∞—Å—Å–æ–≤—ã–µ —Å—á–µ—Ç–∞ –ø–æ —Ç–æ—á–∫–∞–º, –æ—Ç—á—ë—Ç GP

**–§—É–Ω–∫—Ü–∏–∏:**
- –ö–∞—Å—Å–æ–≤—ã–µ —Å—á–µ—Ç–∞ (`account.account`) –ø–æ —Ç–æ—á–∫–∞–º
- –ü–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏
- –û—Ç—á—ë—Ç –≤–∞–ª–æ–≤–æ–π –ø—Ä–∏–±—ã–ª–∏ (GP)
- –û—Ç—á—ë—Ç –ø—Ä–∏–±—ã–ª–∏ –ø–æ —Ç–æ—á–∫–∞–º

**–ú–æ–¥–µ–ª–∏:**
- `account.cash.transfer` ‚Äî –ø–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `sale.order` –∏ `pos.order` –¥–ª—è GP

**–§–∞–π–ª—ã:**
- `models/cash_transfer.py`
- `reports/gp_report.py`
- `reports/profit_by_location.py`

---

## 7. –ê–¥–∞–ø—Ç–µ—Ä –ö–ö–¢ (–¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è)

### SQLite Buffer Schema

**–¢–∞–±–ª–∏—Ü—ã:** `receipts`, `dlq`, `buffer_events`
- **receipts:** id, pos_id, created_at, hlc_*, fiscal_doc, status, retry_count
- **dlq:** Dead Letter Queue –¥–ª—è failed receipts (max_retries=20)
- **buffer_events:** Event Sourcing (receipt_added, synced, failed, circuit_*)

**SQLite Config (–ö–†–ò–¢–ò–ß–ù–û):**
```python
PRAGMA journal_mode=WAL
PRAGMA synchronous=FULL  # ‚ö†Ô∏è Power loss protection
PRAGMA wal_autocheckpoint=100
PRAGMA cache_size=-64000  # 64 MB
```

**Full schema:** `bootstrap/kkt_adapter_skeleton/schema.sql`

### –î–≤—É—Ö—Ñ–∞–∑–Ω–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–∑–∞ 1 (–í–°–ï–ì–î–ê —É—Å–ø–µ—à–Ω–∞):**
1. Generate HLC timestamp
2. Insert to SQLite (`status='pending'`)
3. Print –Ω–∞ –ö–ö–¢
4. Log event (`receipt_added`)

**–§–∞–∑–∞ 2 (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è, best-effort):**
1. Check Circuit Breaker state
2. Send to –û–§–î API (timeout=10s)
3. Update `status='synced'`, set `hlc_server_time`
4. On failure: increment `retry_count` (max=20 ‚Üí DLQ)

**Circuit Breaker:** `failure_threshold=5`, `recovery_timeout=60s`

**Implementation:** –°–º. `kkt_adapter/app/buffer.py`, `ofd_client.py`

### Hybrid Logical Clock

**Ordering:** `server_time > local_time > logical_counter`

```python
@dataclass
class HybridTimestamp:
    local_time: int        # Unix timestamp
    logical_counter: int   # Monotonic counter
    server_time: Optional[int] = None  # Set on sync
```

**Implementation:** `kkt_adapter/app/hlc.py`

### API Endpoints

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/v1/kkt/receipt` | POST | Create fiscal receipt (2-phase) |
| `/v1/kkt/buffer/status` | GET | Buffer fullness, network status |
| `/v1/kkt/buffer/sync` | POST | Manual sync (Distributed Lock) |
| `/v1/health` | GET | Health check (Circuit Breaker state) |

**Full API:** OpenAPI 3.0 spec –≤ `kkt_adapter/openapi.yaml`

---

## 8. –ü–ª–∞–Ω —Å–ø—Ä–∏–Ω—Ç–æ–≤

### POC (W1-5): Proof of Concept

**W1-2:** Docker, Odoo skeletons, FastAPI, SQLite CRUD, HLC
**W3:** 2-phase fiscalization, Circuit Breaker, POC-1
**W4:** Heartbeat, offline mode, catalog cache, POC-4 (8h offline)
**W5:** connector_b import, POC-2/5, Go/No-Go

### MVP (W6-9): –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

**W6-7:** Odoo modules (optics_core, optics_pos_ru54fz, ru_accounting_extras, connector_b)
**W8:** Offline UI, Distributed Lock, Saga, Bulkhead
**W9:** UAT (01-04, 08-11), fix blockers, MVP sign-off

### Buffer (W10): –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è

Load tests (scenarios 1-4), rollback procedure, docs update, CI/CD gates

### –ü–∏–ª–æ—Ç (W11-14): 2 —Ç–æ—á–∫–∏

**W11-12:** Deploy 4 –∫–∞—Å—Å—ã, UPS, training (‚â•90%)
**W13-14:** Grafana, alerts, stress-test (2 –∫–∞—Å—Å—ã √ó 8h √ó 50 receipts), sign-off

### Soft Launch (W15-16): 5 —Ç–æ—á–µ–∫

Deploy 10 –∫–∞—Å—Å, capacity metrics (PG P95 <50ms, Celery queue <30), optimization

### –ü—Ä–æ–¥ (W17-20): 20 —Ç–æ—á–µ–∫

**W17-18:** 40 –∫–∞—Å—Å—ã, pgbouncer, daily backups, DR test (RTO‚â§1h)
**W19-20:** Admin manual, runbook (‚â•20 scenarios), SLA, on-call, sign-off

---

## 8.1. DoD (Definition of Done)

**MVP Exit:**
- ‚úÖ UAT ‚â•95% (11 scenarios), 0 blockers
- ‚úÖ –î—É–±–ª–∏–∫–∞—Ç—ã —á–µ–∫–æ–≤ = 0, P95 –ø–µ—á–∞—Ç–∏ ‚â§7s, –∏–º–ø–æ—Ä—Ç 10k ‚â§2min
- ‚úÖ –û—Ñ–ª–∞–π–Ω: 8h, 50 receipts, sync ‚â§10min
- ‚úÖ Circuit Breaker, Distributed Lock, Saga —Ä–∞–±–æ—Ç–∞—é—Ç (–∞–≤—Ç–æ—Ç–µ—Å—Ç—ã)

**–ü–∏–ª–æ—Ç Exit:**
- ‚úÖ MVP + Uptime ‚â•99.5% (2w), training ‚â•90%, 0 P1 incidents

**–ü—Ä–æ–¥ Exit:**
- ‚úÖ –ü–∏–ª–æ—Ç + 20 —Ç–æ—á–µ–∫, RTO‚â§1h, RPO‚â§24h, monitoring active

---

## 8.2. –†–∏—Å–∫–∏

| –†–∏—Å–∫ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-----------|
| **Buffer overflow** | Alert @80%, block @100%, emergency sync |
| **Clock drift** | NTP mandatory, HLC, drift monitoring |
| **–§–ù full offline** | Alert 3-5d early, replacement procedure |
| **1 dev resource** | MVP focus, test automation, part-time DevOps |

---

## 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

**Prometheus Metrics:**
- `kkt_buffer_percent_full` ‚Äî Buffer fullness %
- `kkt_circuit_breaker_state` ‚Äî CB state (0/1/2)
- `kkt_sync_duration_seconds` ‚Äî Sync latency
- `kkt_dlq_size` ‚Äî DLQ size
- `kkt_hlc_drift_seconds` ‚Äî HLC drift from NTP

**Critical Alerts:**
- **P1:** Buffer ‚â•100% (1m), –§–ù full
- **P2:** Buffer ‚â•80% (5m), CB OPEN (5m)

**Grafana Panels:**
1. –°—Ç–∞—Ç—É—Å –∫–∞—Å—Å (üü¢/üü°/üî¥ map)
2. Circuit Breaker history (24h)
3. Buffer fullness, top-5 POS
4. Performance (P95 print, sync throughput, DLQ)

---

## 10. –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

**Pre-flight:**
- [ ] Buffer <10 —á–µ–∫–æ–≤, NTP active (drift <1s), disk ‚â•10GB
- [ ] Test sale online/offline OK, alerts work
- [ ] Grafana + Prometheus exporter active

**Post-deployment (30min):**
- [ ] Sale on each POS (100%), buffer stable, heartbeat OK

**Post-deployment (24h):**
- [ ] 0 P1/P2 incidents, buffers stable

---

## 11. –†–µ–≥–ª–∞–º–µ–Ω—Ç—ã —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

**–ë—ç–∫–∞–ø—ã:**
- **PostgreSQL:** Daily full + 6h incremental (retention 90d)
- **SQLite:** Daily snapshot (retention 7d) + `PRAGMA wal_checkpoint(TRUNCATE)`

**SLA:**
| Priority | Response | Resolution | Escalation |
|----------|----------|------------|------------|
| P1 | ‚â§15m | ‚â§1h | Owner @30m |
| P2 | ‚â§1h | ‚â§4h | Lead @2h |
| P3 | ‚â§24h | ‚â§3d | ‚Äî |

**On-call:** Weekly rotation (Mon 09:00 ‚Üí Mon 09:00)

---

## 12. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**W1:** Docker setup, Odoo skeletons, FastAPI, SQLite buffer schema
**W2-3:** HLC, Circuit Breaker, POC tests (1-5)
**W4-9:** MVP (all modules + UAT), load tests, pilot prep

**–†–µ—Å—É—Ä—Å—ã:**
- **Docs:** docs/1-5 (–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞, –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è, –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞, –û—Ñ–ª–∞–π–Ω)
- **Specs:** 54-–§–ó, –§–§–î 1.2, Odoo 17 Community
- **Tools:** pybreaker, python-redis-lock, OpenTelemetry

**Summary:**
- ‚úÖ 2-phase fiscalization ‚Üí business continuity
- ‚úÖ Circuit Breaker ‚Üí cascade failure protection
- ‚úÖ HLC ‚Üí correct event ordering
- ‚úÖ 19 weeks (T0 ‚Üí T0+19) to production

---

## 13. AI Agent Handoff Protocol

### Session Start
```bash
# 1. Read last session
cat claude_history/session_$(date +%Y%m%d).md

# 2. Verify env
make verify-env && git status

# 3. Run last checkpoint
pytest tests/unit/test_lens.py -v  # Expected: all PASS
```

**If checkpoint fails:**
- ‚ùå **STOP** ‚Äî do NOT proceed
- Escalate to human with error report (test name, error, last commit, action needed)

### Session End
```bash
# 1. Document progress
cat >> claude_history/session_$(date +%Y%m%d).md << EOF
## Session $(date +%Y-%m-%d\ %H:%M)
### Completed
- ‚úÖ task [file:line]
### Next Tasks
- [ ] next task
### Checkpoints
- W6.1: ‚úÖ PASS
- W6.2: ‚è≥ Pending
EOF

# 2. Commit + Push
git add . && git commit -m "feat(scope): description [W6.1]" && git push
```

### Error Recovery
1. **Regression?** ‚Üí `git reset --hard HEAD~1`
2. **Coverage drop >5%?** ‚Üí ROLLBACK
3. **3 failures?** ‚Üí Escalate to human with detailed issue report

### Code Freeze (After POC)
**FROZEN (no refactor without approval):**
- SQLite schema, HLC implementation, Circuit Breaker config, –§–§–î 1.2 structure, Prometheus metrics

**Refactorable (MVP):**
- API endpoints, UI components, internal functions, variable names

### Context Preservation
**Before end:** Session history updated, checkpoint PASS, git clean, next tasks documented
**Before start:** Read history, verify env, re-run checkpoint
