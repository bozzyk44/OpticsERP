# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Claude
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –∫–æ–¥–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API
- –î–æ–±–∞–≤–ª—è—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π
- –õ—é–±–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ /docs
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –æ—Ç–≤–µ—Ç–æ–≤

## –ü—Ä–∏ –∫–∞–∂–¥–æ–º compact —á–∞—Ç–∞:
- –í—Å–µ–≥–¥–∞ —Ö—Ä–∞–Ω–∏—Ç—å —Å–∞–º–º–∞—Ä–∏ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ –∏ –¥–µ–π—Å—Ç–≤–∏–π
- –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å–∞–º–º–∞—Ä–∏ –≤ /claude_history

## –ü—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:
- –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∞–≤—Ç–æ—Ä–æ–º, –¥–∞—Ç–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º —Ñ–∞–π–ª–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Prettify –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

# CLAUDE.md ‚Äî –ü–ª–∞–Ω –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ OpticsERP (Offline-First POS)

> **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ï–¥–∏–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –±–∞–∑–µ Odoo Community 17 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è —Å–µ—Ç–∏ –æ–ø—Ç–∏–∫.
> **–í–µ—Ä—Å–∏—è:** 1.0 ‚Ä¢ –î–∞—Ç–∞: 2025-10-08 ‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: 1 —á–µ–ª–æ–≤–µ–∫
> **–ë–∞–∑–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:** docs/1-5 (–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏, –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è, –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞, Offline-—Ä–µ–∂–∏–º)

---

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

### 1.1 –¶–µ–ª—å
–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å ERP/POS —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Å–µ—Ç–∏ –æ–ø—Ç–∏–∫ –Ω–∞ –±–∞–∑–µ Odoo Community 17 —Å –∫—Ä–∏—Ç–∏—á–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **offline-first —Ä–µ–∂–∏–º–∞**:
- –ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–∞—Å—Å—ã –ø—Ä–∏ –æ–±—Ä—ã–≤–∞—Ö —Å–≤—è–∑–∏ —Å –û–§–î (8+ —á–∞—Å–æ–≤)
- –ë–∏–∑–Ω–µ—Å-–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å ‚â•99.5% (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 54-–§–ó —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 20 —Ç–æ—á–µ–∫ (40 –∫–∞—Å—Å)

### 1.2 –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
1. **Offline-first:** –∫–∞—Å—Å–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–Ω–æ–º–Ω–æ, –æ–±–ª–∞–∫–æ –≤—Ç–æ—Ä–∏—á–Ω–æ
2. **–î–≤—É—Ö—Ñ–∞–∑–Ω–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è:** –ø–µ—á–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –û–§–î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
3. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞:** 100% —á–µ–∫–æ–≤ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –û–§–î (Circuit Breaker + —Ä–µ—Ç—Ä–∞–∏)
4. **Hybrid Logical Clock:** –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç NTP
5. **Graceful degradation:** –ø–ª–∞–≤–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –±–µ–∑ —Ä–µ–∑–∫–∏—Ö –æ—Ç–∫–∞–∑–æ–≤
6. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:** Circuit Breaker, Saga, Bulkhead, Event Sourcing

### 1.3 –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Backend:**
- Odoo Community 17 (Python 3.11+)
- PostgreSQL 15
- Redis (–æ—á–µ—Ä–µ–¥–∏ Celery)
- Celery (—Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏)

**Edge (–∫–∞—Å—Å–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª):**
- FastAPI (–∞–¥–∞–ø—Ç–µ—Ä –ö–ö–¢)
- SQLite (–æ—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä, WAL mode)
- APScheduler (heartbeat, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- Prometheus + Grafana
- Jaeger (—Ç—Ä–µ–π—Å–∏–Ω–≥)
- Sentry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- Docker + Docker Compose
- Nginx (reverse proxy, TLS 1.3)
- NTP (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏)

---

## 2. –≠—Ç–∞–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (T0 = 06.10.2025)

| –≠—Ç–∞–ø | –°—Ä–æ–∫–∏ | –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã—Ö–æ–¥–∞ | –§–æ–∫—É—Å |
|------|-------|-----------------|-------|
| **POC** | 06.10 - 09.11 (5 –Ω–µ–¥) | POC-4/5 –ø—Ä–æ–π–¥–µ–Ω—ã, –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã | Proof of concept –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞ |
| **MVP** | 10.11 - 07.12 (4 –Ω–µ–¥) | UAT ‚â•95%, –æ—Ñ–ª–∞–π–Ω-UAT 100%, 0 –±–ª–æ–∫–µ—Ä–æ–≤ | –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å |
| **Buffer** | 08.12 - 14.12 (1 –Ω–µ–¥) | –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã, 0 –±–ª–æ–∫–µ—Ä–æ–≤ | –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è |
| **–ü–∏–ª–æ—Ç** | 15.12 - 11.01 (4 –Ω–µ–¥) | –ë–∏–∑–Ω–µ—Å-–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å ‚â•99.5%, –æ–±—É—á–µ–Ω–∏–µ | 2 —Ç–æ—á–∫–∏ (4 –∫–∞—Å—Å—ã) |
| **Soft Launch** | 12.01 - 25.01 (2 –Ω–µ–¥) | Capacity metrics, —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ | 5 —Ç–æ—á–µ–∫ (10 –∫–∞—Å—Å) |
| **–ü—Ä–æ–¥** | 26.01 - 22.02 (4 –Ω–µ–¥) | RTO‚â§1—á, RPO‚â§24—á, 20 —Ç–æ—á–µ–∫ | –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ |

**–ò—Ç–æ–≥–æ:** 19 –Ω–µ–¥–µ–ª—å (T0 ‚Üí T0+19)

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 3.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
OpticsERP/
‚îú‚îÄ‚îÄ addons/                      # Odoo –º–æ–¥—É–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ optics_core/             # –†–µ—Ü–µ–ø—Ç—ã, –ª–∏–Ω–∑—ã, –∑–∞–∫–∞–∑—ã –Ω–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ optics_pos_ru54fz/       # POS + 54-–§–ó + –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º
‚îÇ   ‚îú‚îÄ‚îÄ connector_b/             # –ò–º–ø–æ—Ä—Ç Excel/CSV
‚îÇ   ‚îî‚îÄ‚îÄ ru_accounting_extras/    # –ö–∞—Å—Å–æ–≤—ã–µ —Å—á–µ—Ç–∞, –æ—Ç—á—ë—Ç GP
‚îÇ
‚îú‚îÄ‚îÄ kkt_adapter/                 # –ê–¥–∞–ø—Ç–µ—Ä –ö–ö–¢ (–∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å)
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py              # FastAPI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buffer.py            # SQLite –±—É—Ñ–µ—Ä + CRUD
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kkt_driver.py        # –î—Ä–∞–π–≤–µ—Ä –ö–ö–¢
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ofd_client.py        # –û–§–î API + Circuit Breaker
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sync_worker.py       # –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ heartbeat.py         # Heartbeat –∫ Odoo (30s)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hlc.py               # Hybrid Logical Clock
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buffer.db            # SQLite –æ—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cache.json           # –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à –∫–∞—Ç–∞–ª–æ–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.toml              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ poc/                     # POC-—Ç–µ—Å—Ç—ã (1-5)
‚îÇ   ‚îú‚îÄ‚îÄ uat/                     # UAT-—Ç–µ—Å—Ç—ã (01-11)
‚îÇ   ‚îú‚îÄ‚îÄ load/                    # –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Å—Ü–µ–Ω–∞—Ä–∏–∏ 1-4)
‚îÇ   ‚îî‚îÄ‚îÄ integration/             # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ docs/                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (5 —Ñ–∞–π–ª–æ–≤)
‚îú‚îÄ‚îÄ docker-compose.yml           # –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫
‚îú‚îÄ‚îÄ config.toml                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ CLAUDE.md                    # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

### 3.2 –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–¥—É–ª–∏ Odoo

#### optics_core
**–¶–µ–ª—å:** –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –æ–ø—Ç–∏–∫–∏

**–ú–æ–¥–µ–ª–∏:**
- `optics.prescription` ‚Äî —Ä–µ—Ü–µ–ø—Ç (Sph, Cyl, Axis, PD, Add, Prism)
- `optics.lens` ‚Äî –ª–∏–Ω–∑–∞ (—Ç–∏–ø, –∏–Ω–¥–µ–∫—Å, –ø–æ–∫—Ä—ã—Ç–∏–µ)
- `optics.manufacturing.order` ‚Äî –∑–∞–∫–∞–∑ –Ω–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ

**Workflow –∑–∞–∫–∞–∑–∞:**
```
Draft ‚Üí Confirmed ‚Üí In Production ‚Üí Ready ‚Üí Delivered
```

**–§–∞–π–ª—ã:**
- `models/prescription.py`
- `models/lens.py`
- `models/manufacturing_order.py`
- `views/prescription_views.xml`
- `reports/order_label.xml` (—à—Ç—Ä–∏—Ö–∫–æ–¥)

#### optics_pos_ru54fz
**–¶–µ–ª—å:** POS + 54-–§–ó + –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–¥–∞–ø—Ç–µ—Ä–æ–º –ö–ö–¢ (API –≤—ã–∑–æ–≤—ã)
- X/Z-–æ—Ç—á—ë—Ç—ã (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–µ–≥–∏ –§–§–î 1.2)
- –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π —á–µ–∫ (email/SMS)
- UI –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞ (–∏–Ω–¥–∏–∫–∞—Ü–∏—è –±—É—Ñ–µ—Ä–∞, –∞–ª–µ—Ä—Ç—ã)

**–ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏:**
- `pos.offline.buffer.status` ‚Äî —Å—Ç–∞—Ç—É—Å –±—É—Ñ–µ—Ä–∞ –¥–ª—è UI
- `pos.session.report` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è X/Z-–æ—Ç—á—ë—Ç–æ–≤

**–§–∞–π–ª—ã:**
- `models/pos_session.py` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
- `static/src/js/offline_indicator.js` (UI –≤–∏–¥–∂–µ—Ç)
- `controllers/kkt_adapter_api.py` (–æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ –∞–¥–∞–ø—Ç–µ—Ä–∞)

#### connector_b
**–¶–µ–ª—å:** –ò–º–ø–æ—Ä—Ç –ø—Ä–∞–π—Å–æ–≤/–æ—Å—Ç–∞—Ç–∫–æ–≤ Excel/CSV

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü—Ä–æ—Ñ–∏–ª–∏ –º–∞–ø–ø–∏–Ω–≥–∞ (3+ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- –ü—Ä–µ–≤—å—é –∏–º–ø–æ—Ä—Ç–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- Upsert (—Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—Ç—á—ë—Ç –æ–± –æ—à–∏–±–∫–∞—Ö
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–∏ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±—É—Ñ–µ—Ä–∞—Ö

**–ú–æ–¥–µ–ª–∏:**
- `connector.import.profile` ‚Äî –ø—Ä–æ—Ñ–∏–ª—å –º–∞–ø–ø–∏–Ω–≥–∞
- `connector.import.job` ‚Äî –∑–∞–¥–∞—á–∞ –∏–º–ø–æ—Ä—Ç–∞
- `connector.import.log` ‚Äî –ª–æ–≥–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)

**–§–∞–π–ª—ã:**
- `models/import_profile.py`
- `models/import_job.py`
- `wizards/import_wizard.py` (–ø—Ä–µ–≤—å—é)
- `controllers/import_api.py`

#### ru_accounting_extras
**–¶–µ–ª—å:** –ö–∞—Å—Å–æ–≤—ã–µ —Å—á–µ—Ç–∞ –ø–æ —Ç–æ—á–∫–∞–º, –æ—Ç—á—ë—Ç GP

**–§—É–Ω–∫—Ü–∏–∏:**
- –ö–∞—Å—Å–æ–≤—ã–µ —Å—á–µ—Ç–∞ (`account.account`) –ø–æ —Ç–æ—á–∫–∞–º
- –ü–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏
- –û—Ç—á—ë—Ç –≤–∞–ª–æ–≤–æ–π –ø—Ä–∏–±—ã–ª–∏ (GP)
- –û—Ç—á—ë—Ç –ø—Ä–∏–±—ã–ª–∏ –ø–æ —Ç–æ—á–∫–∞–º

**–ú–æ–¥–µ–ª–∏:**
- `account.cash.transfer` ‚Äî –ø–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `sale.order` –∏ `pos.order` –¥–ª—è GP

**–§–∞–π–ª—ã:**
- `models/cash_transfer.py`
- `reports/gp_report.py`
- `reports/profit_by_location.py`

---

## 4. –ê–¥–∞–ø—Ç–µ—Ä –ö–ö–¢ (kkt_adapter) ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è

### 4.1 –û—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä (SQLite)

**–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —á–µ–∫–æ–≤
CREATE TABLE receipts (
  id TEXT PRIMARY KEY,              -- UUIDv4
  pos_id TEXT NOT NULL,
  created_at INTEGER NOT NULL,      -- Unix timestamp
  hlc_local_time INTEGER NOT NULL,  -- Hybrid Logical Clock
  hlc_logical_counter INTEGER NOT NULL,
  hlc_server_time INTEGER,          -- –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  fiscal_doc TEXT NOT NULL,         -- JSON –§–§–î
  status TEXT NOT NULL DEFAULT 'pending',  -- pending|syncing|synced|failed
  retry_count INTEGER DEFAULT 0,
  last_error TEXT,
  synced_at INTEGER,
  CHECK (status IN ('pending', 'syncing', 'synced', 'failed'))
);

CREATE INDEX idx_status ON receipts(status);
CREATE INDEX idx_created_at ON receipts(created_at);
CREATE INDEX idx_hlc ON receipts(hlc_server_time, hlc_local_time, hlc_logical_counter);

-- Dead Letter Queue
CREATE TABLE dlq (
  id TEXT PRIMARY KEY,
  original_receipt_id TEXT NOT NULL,
  failed_at INTEGER NOT NULL,
  reason TEXT NOT NULL,
  fiscal_doc TEXT NOT NULL,
  retry_attempts INTEGER NOT NULL,
  last_error TEXT,
  resolved_at INTEGER,
  resolved_by TEXT,
  FOREIGN KEY (original_receipt_id) REFERENCES receipts(id)
);

-- –°–æ–±—ã—Ç–∏—è (Event Sourcing)
CREATE TABLE buffer_events (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  event_type TEXT NOT NULL,
  receipt_id TEXT,
  timestamp INTEGER NOT NULL,
  metadata TEXT,
  CHECK (event_type IN ('receipt_added', 'receipt_synced', 'receipt_failed',
                        'circuit_opened', 'circuit_closed', 'sync_started', 'sync_completed'))
);
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SQLite (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è durability):**
```python
def init_buffer_db(db_path='/app/data/buffer.db'):
    conn = sqlite3.connect(db_path)

    # –ö–†–ò–¢–ò–ß–ù–û: –∑–∞—â–∏—Ç–∞ –æ—Ç power loss
    conn.execute("PRAGMA journal_mode=WAL")
    conn.execute("PRAGMA synchronous=FULL")       # !!!
    conn.execute("PRAGMA wal_autocheckpoint=100")
    conn.execute("PRAGMA cache_size=-64000")      # 64 MB
    conn.execute("PRAGMA foreign_keys=ON")

    return conn
```

### 4.2 –î–≤—É—Ö—Ñ–∞–∑–Ω–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–∑–∞ 1: –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–≤—Å–µ–≥–¥–∞ —É—Å–ø–µ—à–Ω–∞)**
```python
def create_receipt_phase1(receipt_data):
    """
    –§–∞–∑–∞ 1: –ª–æ–∫–∞–ª—å–Ω–∞—è ‚Äî –≤—Å–µ–≥–¥–∞ —É—Å–ø–µ—à–Ω–∞, –¥–∞–∂–µ –±–µ–∑ —Å–µ—Ç–∏.
    """
    # 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Hybrid Logical Clock timestamp
    hlc = generate_hlc()
    receipt_id = str(uuid.uuid4())

    # 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ SQLite
    buffer_db.execute(
        """INSERT INTO receipts
           (id, pos_id, created_at, hlc_local_time, hlc_logical_counter, fiscal_doc, status)
           VALUES (?, ?, ?, ?, ?, ?, 'pending')""",
        (receipt_id, receipt_data['pos_id'], int(time.time()),
         hlc.local_time, hlc.logical_counter, json.dumps(receipt_data))
    )
    buffer_db.commit()

    # 3. –ü–µ—á–∞—Ç—å —á–µ–∫–∞ –Ω–∞ –ö–ö–¢
    try:
        kkt_driver.print_receipt(receipt_data)
    except TimeoutError:
        send_alert(f"–ö–ö–¢ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ {receipt_data['pos_id']}", level='P2')

    # 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
    buffer_db.execute(
        "INSERT INTO buffer_events (event_type, receipt_id, timestamp) VALUES (?, ?, ?)",
        ('receipt_added', receipt_id, int(time.time()))
    )

    return receipt_id
```

**–§–∞–∑–∞ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –û–§–î (—Å Circuit Breaker)**
```python
class OFDCircuitBreaker:
    @circuit(failure_threshold=5, recovery_timeout=60)
    async def send_receipt(self, receipt):
        response = await ofd_client.post("/receipts", json=receipt, timeout=10)
        return response

async def create_receipt_phase2(receipt_id):
    """
    –§–∞–∑–∞ 2: –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –û–§–î (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è, best-effort)
    """
    receipt = buffer_db.execute(
        "SELECT * FROM receipts WHERE id = ? AND status = 'pending'",
        (receipt_id,)
    ).fetchone()

    if not receipt:
        return

    try:
        if ofd_cb.current_state == "OPEN":
            log.warning(f"Circuit Breaker OPEN, buffering {receipt_id}")
            return

        fiscal_doc = await ofd_cb.send_receipt(json.loads(receipt['fiscal_doc']))

        buffer_db.execute(
            """UPDATE receipts
               SET status='synced', synced_at=?, hlc_server_time=?
               WHERE id=?""",
            (int(time.time()), get_server_time(), receipt_id)
        )
        buffer_db.commit()

    except CircuitBreakerError:
        log.warning(f"Circuit Breaker opened for {receipt_id}")

    except (TimeoutError, ConnectionError) as e:
        buffer_db.execute(
            "UPDATE receipts SET retry_count = retry_count + 1, last_error = ? WHERE id = ?",
            (str(e), receipt_id)
        )
        buffer_db.commit()

        if receipt['retry_count'] + 1 >= 20:
            move_to_dlq(receipt_id, reason="max_retries_exceeded")
```

### 4.3 Hybrid Logical Clock

```python
@dataclass
class HybridTimestamp:
    local_time: int        # Unix timestamp –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
    logical_counter: int   # –ú–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π —Å—á—ë—Ç—á–∏–∫
    server_time: Optional[int] = None  # –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

    def __lt__(self, other):
        # –ü–æ—Ä—è–¥–æ–∫: server_time > local_time > logical_counter
        if self.server_time and other.server_time:
            if self.server_time != other.server_time:
                return self.server_time < other.server_time
        elif self.local_time != other.local_time:
            return self.local_time < other.local_time
        return self.logical_counter < other.logical_counter

def generate_hlc():
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Hybrid Logical Clock timestamp"""
    global _hlc_counter, _last_hlc_time

    current_time = int(time.time())

    if current_time == _last_hlc_time:
        _hlc_counter += 1
    else:
        _hlc_counter = 0
        _last_hlc_time = current_time

    return HybridTimestamp(
        local_time=current_time,
        logical_counter=_hlc_counter,
        server_time=None
    )
```

### 4.4 API endpoints –∞–¥–∞–ø—Ç–µ—Ä–∞

```yaml
# OpenAPI 3.0.3
paths:
  /v1/kkt/receipt:
    post:
      summary: Create fiscal receipt (–¥–≤—É—Ö—Ñ–∞–∑–Ω–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è)
      parameters:
        - name: Idempotency-Key
          in: header
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [pos_id, type, items, payments]
              properties:
                pos_id: { type: string }
                type: { enum: [sale, refund, correction] }
                items: { type: array }
                payments: { type: array }
      responses:
        '200':
          description: –ß–µ–∫ –Ω–∞–ø–µ—á–∞—Ç–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ
          content:
            application/json:
              schema:
                properties:
                  status: { enum: [printed, buffered] }
                  receipt_id: { type: string, format: uuid }
                  fiscal_doc: { type: object, nullable: true }
        '503':
          description: –û—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω

  /v1/kkt/buffer/status:
    get:
      summary: –°—Ç–∞—Ç—É—Å –æ—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä–∞
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  total_capacity: { type: integer, example: 200 }
                  current_queued: { type: integer }
                  percent_full: { type: number }
                  network_status: { enum: [online, offline, degraded] }

  /v1/kkt/buffer/sync:
    post:
      summary: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
      security: [AdminAuth: []]
      requestBody:
        content:
          application/json:
            schema:
              properties:
                force: { type: boolean, default: false }
      responses:
        '202':
          description: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞
        '409':
          description: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É–∂–µ –∏–¥–µ—Ç (Distributed Lock)

  /v1/health:
    get:
      summary: Health check
      responses:
        '200':
          content:
            application/json:
              schema:
                properties:
                  status: { enum: [healthy, degraded, unhealthy] }
                  components:
                    type: object
                    properties:
                      circuit_breaker:
                        properties:
                          state: { enum: [CLOSED, OPEN, HALF_OPEN] }
```

---

## 5. –ü–ª–∞–Ω —Å–ø—Ä–∏–Ω—Ç–æ–≤ (–¥–µ—Ç–∞–ª—å–Ω–æ)

### 5.1 –°–ø—Ä–∏–Ω—Ç 1-3: POC (5 –Ω–µ–¥–µ–ª—å)

**–ù–µ–¥–µ–ª—è 1-2: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker-–æ–∫—Ä—É–∂–µ–Ω–∏—è (Odoo + PostgreSQL + Redis)
- [ ] –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π Odoo (—Å–∫–µ–ª–µ—Ç—ã)
- [ ] –ê–¥–∞–ø—Ç–µ—Ä –ö–ö–¢: FastAPI skeleton
- [ ] SQLite –±—É—Ñ–µ—Ä: —Å—Ö–µ–º–∞ + CRUD
- [ ] Hybrid Logical Clock: –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è + unit-—Ç–µ—Å—Ç—ã

**–ù–µ–¥–µ–ª—è 3: –î–≤—É—Ö—Ñ–∞–∑–Ω–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è + Circuit Breaker**
- [ ] –§–∞–∑–∞ 1: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ SQLite + –ø–µ—á–∞—Ç—å
- [ ] –§–∞–∑–∞ 2: –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ –û–§–î (mock)
- [ ] Circuit Breaker: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] POC-1: —ç–º—É–ª—è—Ç–æ—Ä –ö–ö–¢ + 50 –æ–ø–µ—Ä–∞—Ü–∏–π

**–ù–µ–¥–µ–ª—è 4: Heartbeat + –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º**
- [ ] Heartbeat –∫ Odoo (30s, hysteresis)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ online/offline/degraded
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à –∫–∞—Ç–∞–ª–æ–≥–∞ (1000 —Ç–æ–≤–∞—Ä–æ–≤)
- [ ] POC-4: 8—á –æ—Ñ–ª–∞–π–Ω, 50 —á–µ–∫–æ–≤, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

**–ù–µ–¥–µ–ª—è 5: –ò–º–ø–æ—Ä—Ç + POC-5 (split-brain)**
- [ ] connector_b: –±–∞–∑–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç Excel
- [ ] POC-2: –∏–º–ø–æ—Ä—Ç 10k —Å—Ç—Ä–æ–∫
- [ ] POC-5: —Ç–µ—Å—Ç—ã split-brain, flapping, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- [ ] –û—Ç—á—ë—Ç POC + Go/No-Go —Ä–µ—à–µ–Ω–∏–µ

### 5.2 –°–ø—Ä–∏–Ω—Ç 4-5: MVP (4 –Ω–µ–¥–µ–ª–∏)

**–ù–µ–¥–µ–ª—è 6-7: Odoo –º–æ–¥—É–ª–∏**
- [ ] optics_core: –º–æ–¥–µ–ª–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤/–ª–∏–Ω–∑/–∑–∞–∫–∞–∑–æ–≤
- [ ] optics_pos_ru54fz: POS UI + X/Z-–æ—Ç—á—ë—Ç—ã
- [ ] ru_accounting_extras: –∫–∞—Å—Å–æ–≤—ã–µ —Å—á–µ—Ç–∞ + GP
- [ ] connector_b: –ø—Ä–æ—Ñ–∏–ª–∏ –º–∞–ø–ø–∏–Ω–≥–∞ + –ø—Ä–µ–≤—å—é

**–ù–µ–¥–µ–ª—è 8: –û—Ñ–ª–∞–π–Ω UI + –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã**
- [ ] UI –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞: —Å—Ç–∞—Ç—É—Å-–±–∞—Ä, tooltip, –∞–ª–µ—Ä—Ç—ã
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–û—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä" (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
- [ ] Distributed Lock –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (Redis)
- [ ] Saga Pattern –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —á–µ–∫–∞
- [ ] Bulkhead Pattern (Celery –æ—á–µ—Ä–µ–¥–∏: critical/high/default/low)

**–ù–µ–¥–µ–ª—è 9: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + UAT**
- [ ] UAT-01/02/03/04: –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- [ ] UAT-08/09/10b/10c/11: –æ—Ñ–ª–∞–π–Ω-—Å—Ü–µ–Ω–∞—Ä–∏–∏
- [ ] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤
- [ ] MVP sign-off

### 5.3 –°–ø—Ä–∏–Ω—Ç 6: Buffer (1 –Ω–µ–¥–µ–ª—è)

**–ù–µ–¥–µ–ª—è 10: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è**
- [ ] –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Å—Ü–µ–Ω–∞—Ä–∏–∏ 1-3)
- [ ] –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç (5 –∫–∞—Å—Å, —Å—Ü–µ–Ω–∞—Ä–∏–π 4)
- [ ] Rollback-–ø—Ä–æ—Ü–µ–¥—É—Ä–∞: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö 5 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] CI/CD gate: –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è DoD

### 5.4 –°–ø—Ä–∏–Ω—Ç 7-8: –ü–∏–ª–æ—Ç (4 –Ω–µ–¥–µ–ª–∏)

**–ù–µ–¥–µ–ª—è 11-12: –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ 2 —Ç–æ—á–µ–∫**
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –ö–ö–¢ –Ω–∞ 4 –∫–∞—Å—Å—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ UPS + graceful shutdown
- [ ] –û–±—É—á–µ–Ω–∏–µ –∫–∞—Å—Å–∏—Ä–æ–≤ (‚â•90% –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞)
- [ ] –†–µ–≥–ª–∞–º–µ–Ω—Ç X/Z-–æ—Ç—á—ë—Ç–æ–≤ + –æ—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä

**–ù–µ–¥–µ–ª—è 13-14: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ + —Ä–µ–∞–ª—å–Ω–∞—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è**
- [ ] Grafana dashboard (4 –ø–∞–Ω–µ–ª–∏)
- [ ] –ê–ª–µ—Ä—Ç—ã Prometheus + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (email/telegram)
- [ ] Stress-test: 2 –∫–∞—Å—Å—ã √ó 8—á –æ—Ñ–ª–∞–π–Ω √ó 50 —á–µ–∫–æ–≤
- [ ] Decision Tree –¥–ª—è L1/L2
- [ ] –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∑–∞–º–µ–Ω—ã –§–ù
- [ ] –ü–∏–ª–æ—Ç sign-off

### 5.5 –°–ø—Ä–∏–Ω—Ç 9: Soft Launch (2 –Ω–µ–¥–µ–ª–∏)

**–ù–µ–¥–µ–ª—è 15-16: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ 5 —Ç–æ—á–µ–∫ + capacity metrics**
- [ ] –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–∞—Å—Å (–∏—Ç–æ–≥–æ 10)
- [ ] –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π (—Å—Ü–µ–Ω–∞—Ä–∏–π 4: 5 –∫–∞—Å—Å, 1000 —á–µ–∫–æ–≤/–¥–µ–Ω—å)
- [ ] Capacity metrics: PostgreSQL, Celery, Odoo
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∑–∫–∏—Ö –º–µ—Å—Ç:
  - [ ] PostgreSQL query P95 <50ms
  - [ ] Celery critical queue <30 –∑–∞–¥–∞—á
  - [ ] –ù–µ—Ç OOM/CPU throttling
- [ ] –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Å—Å—ã (–∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ + —Ç–µ—Å—Ç)
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
- [ ] Soft Launch sign-off

### 5.6 –°–ø—Ä–∏–Ω—Ç 10-11: –ü—Ä–æ–¥—É–∫—Ç–∏–≤ (4 –Ω–µ–¥–µ–ª–∏)

**–ù–µ–¥–µ–ª—è 17-18: –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ 20 —Ç–æ—á–µ–∫**
- [ ] –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 20 —Ç–æ—á–µ–∫ (40 –∫–∞—Å—Å)
- [ ] pgbouncer: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ë—ç–∫–∞–ø—ã –æ—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä–æ–≤: –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ snapshot
- [ ] DR-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: RTO‚â§1—á, RPO‚â§24—á

**–ù–µ–¥–µ–ª—è 19-20: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è + Day 2 Ops**
- [ ] –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (‚â•50 —Å—Ç—Ä–∞–Ω–∏—Ü)
- [ ] Runbook (‚â•20 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
- [ ] SLA –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ + –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —ç—Å–∫–∞–ª–∞—Ü–∏–∏
- [ ] On-call –ø—Ä–æ—Ü–µ–¥—É—Ä–∞
- [ ] –†–µ–≥–ª–∞–º–µ–Ω—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- [ ] –ü—Ä–æ–¥—É–∫—Ç–∏–≤ sign-off

---

## 6. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ —ç—Ç–∞–ø–æ–≤ (DoD)

### 6.1 MVP Exit

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è |
|----------|----------------------|---------------|
| **‚â•95% UAT –ø—Ä–æ–π–¥–µ–Ω–æ** | –ü—Ä–æ—Ç–æ–∫–æ–ª UAT (11 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤) | –ß–∞—Å—Ç–∏—á–Ω–æ (–∞–≤—Ç–æ—Ç–µ—Å—Ç—ã) |
| **0 –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤** | JIRA: `type=Bug AND severity=Blocker AND status!=Closed` | –ü–æ–ª–Ω–æ—Å—Ç—å—é (CI gate) |
| **–î—É–±–ª–∏–∫–∞—Ç—ã —á–µ–∫–æ–≤ = 0** | SQL-–∑–∞–ø—Ä–æ—Å –ø–æ –±—É—Ñ–µ—Ä—É + –û–§–î API | –ü–æ–ª–Ω–æ—Å—Ç—å—é (pytest) |
| **P95 –ø–µ—á–∞—Ç–∏ ‚â§7—Å** | Jaeger traces –∑–∞ 24—á | –ü–æ–ª–Ω–æ—Å—Ç—å—é (Jaeger API) |
| **–ò–º–ø–æ—Ä—Ç 10k ‚â§2 –º–∏–Ω** | –¢–µ—Å—Ç–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç | –ü–æ–ª–Ω–æ—Å—Ç—å—é (pytest) |
| **–û—Ñ–ª–∞–π–Ω: 8—á, 50 —á–µ–∫–æ–≤, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚â§10 –º–∏–Ω** | –ê–≤—Ç–æ—Ç–µ—Å—Ç POC-4 | –ü–æ–ª–Ω–æ—Å—Ç—å—é (pytest + tc qdisc) |
| **UAT-08/09/10b/10c/11 –ø—Ä–æ–π–¥–µ–Ω—ã** | –†—É—á–Ω—ã–µ –æ—Ñ–ª–∞–π–Ω-UAT | –ß–∞—Å—Ç–∏—á–Ω–æ (backend –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã) |
| **Circuit Breaker —Ä–∞–±–æ—Ç–∞–µ—Ç** | –≠–º—É–ª—è—Ü–∏—è 5 –æ—à–∏–±–æ–∫ –û–§–î ‚Üí OPEN ‚Üí HALF_OPEN | –ê–≤—Ç–æ—Ç–µ—Å—Ç (pytest) |
| **Distributed Lock —Ä–∞–±–æ—Ç–∞–µ—Ç** | –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚Üí HTTP 409 | –ê–≤—Ç–æ—Ç–µ—Å—Ç (pytest) |
| **Saga Pattern —Ä–∞–±–æ—Ç–∞–µ—Ç** | –í–æ–∑–≤—Ä–∞—Ç –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —á–µ–∫–∞ ‚Üí HTTP 409 | –ê–≤—Ç–æ—Ç–µ—Å—Ç (pytest) |

### 6.2 –ü–∏–ª–æ—Ç Exit

- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ MVP
- ‚úÖ –ë–∏–∑–Ω–µ—Å-–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å ‚â•99.5% (2 –Ω–µ–¥–µ–ª–∏)
- ‚úÖ –û–±—É—á–µ–Ω–∏–µ –∫–∞—Å—Å–∏—Ä–æ–≤: ‚â•90% –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç
- ‚úÖ –†–µ–≥–ª–∞–º–µ–Ω—Ç—ã X/Z + –æ—Ñ–ª–∞–π–Ω —É—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã
- ‚úÖ Stress-test: 2 –∫–∞—Å—Å—ã √ó 8—á √ó 50 —á–µ–∫–æ–≤ ‚Üí 100% —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- ‚úÖ 0 P1 –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∑–∞ 2 –Ω–µ–¥–µ–ª–∏

### 6.3 –ü—Ä–æ–¥—É–∫—Ç–∏–≤ Exit

- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ü–∏–ª–æ—Ç–∞
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ: 20 —Ç–æ—á–µ–∫ (40 –∫–∞—Å—Å)
- ‚úÖ RTO‚â§1—á, RPO‚â§24—á (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ)
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –¥–∞—à–±–æ—Ä–¥ + –∞–ª–µ—Ä—Ç—ã –∞–∫—Ç–∏–≤–Ω—ã
- ‚úÖ –ë—ç–∫–∞–ø—ã: PostgreSQL + SQLite –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
- ‚úÖ –†–µ–≥–ª–∞–º–µ–Ω—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã

---

## 7. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| **–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä–∞** | –°—Ä–µ–¥–Ω—è—è | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | –ê–ª–µ—Ä—Ç –ø—Ä–∏ 80%, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ 100%, –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |
| **–†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ö–ö–¢** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | NTP –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, Hybrid Clock —Å–Ω–∏–∂–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ drift |
| **–§–ù –∑–∞–ø–æ–ª–Ω–µ–Ω –≤–æ –≤—Ä–µ–º—è –æ—Ñ–ª–∞–π–Ω–∞** | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | –ê–ª–µ—Ä—Ç –∑–∞ 3-5 –¥–Ω–µ–π, –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –∑–∞–º–µ–Ω—ã –§–ù —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –±—É—Ñ–µ—Ä–∞ |
| **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (1 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫)** | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –§–æ–∫—É—Å –Ω–∞ MVP, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤, part-time DevOps/QA |
| **–ù–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –ø—Ä–∞–π—Å—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤** | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è, –ø—Ä–µ–≤—å—é –∏–º–ø–æ—Ä—Ç–∞, –∞–ª–µ—Ä—Ç—ã –Ω–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è >20% |

---

## 8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### 8.1 –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Prometheus

```python
# –û—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä
kkt_buffer_size = Gauge('kkt_buffer_size', 'Current buffer size', ['pos_id'])
kkt_buffer_percent_full = Gauge('kkt_buffer_percent_full', 'Buffer fullness %', ['pos_id'])

# Circuit Breaker
kkt_circuit_breaker_state = Gauge('kkt_circuit_breaker_state', 'State: 0=CLOSED, 1=OPEN, 2=HALF_OPEN', ['pos_id'])
kkt_circuit_breaker_opens = Counter('kkt_circuit_breaker_opens_total', 'Times opened', ['pos_id'])

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
kkt_sync_duration_seconds = Histogram('kkt_sync_duration_seconds', 'Sync duration', ['pos_id'])
kkt_receipts_synced = Counter('kkt_receipts_synced_total', 'Total synced', ['pos_id', 'status'])

# DLQ
kkt_dlq_size = Gauge('kkt_dlq_size', 'Dead Letter Queue size', ['pos_id'])

# Hybrid Clock
kkt_hlc_drift_seconds = Gauge('kkt_hlc_drift_seconds', 'HLC drift from NTP', ['pos_id'])
```

### 8.2 –ê–ª–µ—Ä—Ç—ã (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ)

```yaml
groups:
  - name: offline_mode_alerts
    rules:
      - alert: OfflineBufferWarning
        expr: kkt_buffer_percent_full >= 80
        for: 5m
        labels: { severity: P2 }
        annotations:
          summary: "–û—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä ‚â•80% –Ω–∞ {{ $labels.pos_id }}"

      - alert: OfflineBufferFull
        expr: kkt_buffer_percent_full >= 100
        for: 1m
        labels: { severity: P1 }
        annotations:
          summary: "–û—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω –Ω–∞ {{ $labels.pos_id }}"

      - alert: CircuitBreakerOpen
        expr: kkt_circuit_breaker_state == 1
        for: 5m
        labels: { severity: P2 }
        annotations:
          summary: "Circuit Breaker OPEN –Ω–∞ {{ $labels.pos_id }}"
```

### 8.3 Grafana Dashboard (4 –ø–∞–Ω–µ–ª–∏)

1. **–°—Ç–∞—Ç—É—Å –∫–∞—Å—Å:** –∫–∞—Ä—Ç–∞ —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π (üü¢/üü°/üî¥)
2. **Circuit Breaker:** —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞ 24—á (CLOSED/OPEN/HALF_OPEN)
3. **–û—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä:** –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å, —Ç–æ–ø-5 –∫–∞—Å—Å, —Å—Ä–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** P95 –ø–µ—á–∞—Ç–∏, throughput —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, DLQ

---

## 9. –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ–º

### 9.1 Pre-flight (–ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ–º)

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- [ ] –û—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä –ø—É—Å—Ç (<10 —á–µ–∫–æ–≤ –Ω–∞ –≤—Å–µ—Ö –∫–∞—Å—Å–∞—Ö)
- [ ] NTP-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞ (drift <1—Å)
- [ ] –ö—ç—à –∫–∞—Ç–∞–ª–æ–≥–∞ –∞–∫—Ç—É–∞–ª–µ–Ω (<1—á –¥–∞–≤–Ω–æ—Å—Ç–∏)
- [ ] –°–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ ‚â•10GB
- [ ] Heartbeat –∫ Odoo —Ä–∞–±–æ—Ç–∞–µ—Ç (100% –∫–∞—Å—Å)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–¥–∞–∂–∞ –≤ –æ–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ —É—Å–ø–µ—à–Ω–∞ (–≤—Å–µ –∫–∞—Å—Å—ã)
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–¥–∞–∂–∞ –≤ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ —É—Å–ø–µ—à–Ω–∞ (–º–∏–Ω–∏–º—É–º 1 –∫–∞—Å—Å–∞)
- [ ] –ê–ª–µ—Ä—Ç—ã —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Ç–µ—Å—Ç –Ω–∞ —Å—Ç–µ–Ω–¥–µ)

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- [ ] Grafana –¥–∞—à–±–æ—Ä–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –∞–∫—Ç—É–∞–ª–µ–Ω
- [ ] Prometheus exporter —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –∞–¥–∞–ø—Ç–µ—Ä–∞—Ö
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–Ω–∞–ª–∞–º–∏ –∞–ª–µ—Ä—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 9.2 Post-deployment (smoke-test)

**–í —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç:**
- [ ] –ü—Ä–æ–¥–∞–∂–∞ –Ω–∞ –∫–∞–∂–¥–æ–π –∫–∞—Å—Å–µ (100% —É—Å–ø–µ—Ö)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä–æ–≤ (—Ä–∞–∑–º–µ—Ä –Ω–µ –≤—ã—Ä–æ—Å)
- [ ] Heartbeat –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤—Å–µ –∫–∞—Å—Å—ã)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤

**–í —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤:**
- [ ] –ù–µ—Ç P1/P2 –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
- [ ] –û—Ñ–ª–∞–π–Ω-–±—É—Ñ–µ—Ä—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã
- [ ] –õ–æ–≥–∏: –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫

---

## 10. –†–µ–≥–ª–∞–º–µ–Ω—Ç—ã —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

### 10.1 –ë—ç–∫–∞–ø—ã

**PostgreSQL:**
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π full backup (pg_dump)
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- –†–µ—Ç–µ–Ω—Ü–∏—è: 90 –¥–Ω–µ–π

**SQLite –±—É—Ñ–µ—Ä—ã:**
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π snapshot –≤—Å–µ—Ö SQLite-—Ñ–∞–π–ª–æ–≤
- –†–µ—Ç–µ–Ω—Ü–∏—è: 7 –¥–Ω–µ–π
- `PRAGMA wal_checkpoint(TRUNCATE)` –ø–µ—Ä–µ–¥ backup

### 10.2 SLA –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | Response | Resolution | –≠—Å–∫–∞–ª–∞—Ü–∏—è |
|-----------|----------|------------|-----------|
| P1 (Critical) | ‚â§15 –º–∏–Ω | ‚â§1 —á | –í–ª–∞–¥–µ–ª–µ—Ü —á–µ—Ä–µ–∑ 30 –º–∏–Ω |
| P2 (High) | ‚â§1 —á | ‚â§4 —á | –¢–µ—Ö. –ª–∏–¥–µ—Ä —á–µ—Ä–µ–∑ 2—á |
| P3 (Medium) | ‚â§24 —á | ‚â§3 –¥–Ω—è | –ù–µ—Ç |

### 10.3 On-call

**–ö–æ–Ω—Ç–∞–∫—Ç—ã:**
- L1: __________________ (—Ç–µ–ª–µ—Ñ–æ–Ω, telegram)
- L2: __________________ (—Ç–µ–ª–µ—Ñ–æ–Ω, telegram)
- –í–ª–∞–¥–µ–ª–µ—Ü: __________________ (—Ç–æ–ª—å–∫–æ P1)

**–†–æ—Ç–∞—Ü–∏—è:** –Ω–µ–¥–µ–ª—å–Ω–∞—è (–ø–Ω 09:00 ‚Üí –ø–Ω 09:00)

---

## 11. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–ù–µ–¥–µ–ª—è 1):
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Docker-–æ–∫—Ä—É–∂–µ–Ω–∏–µ (docker-compose.yml)
2. –°–æ–∑–¥–∞—Ç—å —Å–∫–µ–ª–µ—Ç—ã –º–æ–¥—É–ª–µ–π Odoo
3. –ù–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∞–¥–∞–ø—Ç–µ—Ä–∞ –ö–ö–¢ (FastAPI)
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å SQLite –±—É—Ñ–µ—Ä —Å –±–∞–∑–æ–≤–æ–π —Å—Ö–µ–º–æ–π

### –ö–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ (–ù–µ–¥–µ–ª—è 2-3):
1. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Hybrid Logical Clock
2. –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å Circuit Breaker –¥–ª—è –û–§–î
3. –°–æ–∑–¥–∞—Ç—å POC-—Ç–µ—Å—Ç—ã (1-5)

### –°—Ä–µ–¥–Ω–∏–π —Å—Ä–æ–∫ (–ù–µ–¥–µ–ª—è 4-9):
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å MVP (–≤—Å–µ –º–æ–¥—É–ª–∏ + UAT)
2. –ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
3. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ –ø–∏–ª–æ—Ç—É

---

## 12. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- docs/1. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏.md ‚Äî —Ü–µ–ª–∏, OKR, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- docs/2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è.md ‚Äî —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ/–Ω–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, UAT
- docs/3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.md ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, API, —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
- docs/4. –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞.md ‚Äî –ø–ª–∞–Ω —Ä–∞–±–æ—Ç, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
- docs/5. –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º—É.md ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ñ–ª–∞–π–Ω, Decision Tree, –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

**–í–Ω–µ—à–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- 54-–§–ó: —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å
- –§–§–î 1.2: —Ñ–æ—Ä–º–∞—Ç —Ñ–∏—Å–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Odoo 17 Community: –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- Circuit Breaker: –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `pybreaker`
- Distributed Lock: Redis + `python-redis-lock`
- Hybrid Clock: custom –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è
- OpenTelemetry: —Ç—Ä–µ–π—Å–∏–Ω–≥

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –ø–ª–∞–Ω –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ OpticsERP —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ **offline-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** –∫–∞–∫ –∫—Ä–∏—Ç–∏—á–Ω–æ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–∏. –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

‚úÖ **–î–≤—É—Ö—Ñ–∞–∑–Ω–∞—è —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –±–∏–∑–Ω–µ—Å-–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç—å
‚úÖ **Circuit Breaker** –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤
‚úÖ **Hybrid Logical Clock** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ–±—ã—Ç–∏–π
‚úÖ **Distributed Lock** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
‚úÖ **19 –Ω–µ–¥–µ–ª—å** –æ—Ç —Å—Ç–∞—Ä—Ç–∞ –¥–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–∞ (T0 ‚Üí T0+19)
‚úÖ **–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω** —Å —á—ë—Ç–∫–∏–º–∏ –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏ —É—Å–ø–µ—Ö–∞

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –Ω–∞—á–∞—Ç—å –°–ø—Ä–∏–Ω—Ç 1 (POC) —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
